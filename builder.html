<!-- builder.html -->
<!-- Authors: Tyler Griggs and Gregory Kofman -->
<!-- Neural Net building page -->

<!DOCTYPE html>

<html>

	<head>

		<!-- Character set -->
		<meta charset="UTF-8"/>

		<!-- Revisit title later -->
		<title>Drag Learning</title>

		<!-- Bootstrap CSS link --> 
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

		<!-- Custom CSS -->
		<link rel="stylesheet" type="text/css" href="css/index.css">
		
		<!-- Bootstrap's required JS links -->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

		<!-- W3 Styles -->
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		
		<!-- Custom CSS -->
		<link rel="stylesheet" type="text/css" href="css/builder.css">
		
		<!-- Javscript scripts -->
		<link rel="stylesheet" type="text/css" href="css/builder.css">

	</head>

	<body>
	
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
  			<a class="navbar-brand" href="#">Drag Learning</a>
			
  			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    			<span class="navbar-toggler-icon"></span>
  			</button>
			
  			<div class="collapse navbar-collapse" id="navbarNavDropdown">
    			<ul class="navbar-nav">
      				<li class="nav-item active">
        				<a class="nav-link" href="#">Home<span class="sr-only">(current)</span></a>
      				</li>
      				<li class="nav-item">
        				<a class="nav-link" href="#">About</a>
      				</li>
      				<li class="nav-item">
        				<a class="nav-link" href="#">Meet the Team</a>
      				</li>
      				<li class="nav-item">
      					<a class="nav-link" href="#">Contact Us</a>
      				</li>
    			</ul>
  			</div>
			
		</nav>

		
		<!-- Layer Selection - Left Side-Bar -->
		<div class="layer-selection">
			<p>Layers</p>
			<button id="dense-button" onclick="addParams('param-dense-div0');addLayer('dense-div0');" class="layer-button w3-button w3-round-large">Dense</button>
			<button id="act-button" onclick="addParams('param-act-div0');addLayer('act-div0');" class="layer-button w3-button w3-round-large">Activation</button>
			<button id="drop-button" onclick="addParams('param-drop-div0');addLayer('drop-div0');" class="layer-button w3-button w3-round-large">Dropout</button>
		</div>
		
		
		<!-- Layer Display - Center Area -->
		<div class="editing-area row" style="background-image:url('images/graphBG.png');">
		
			<!-- Divs for Layers - to be Dynamically added to above container -->
			<div id="dense-div0" class="row desc-arrow-container" onclick="updateSelected(this.id);">
				<div class="desc-container">
					<p class="layer-title">Dense</p>
					<p>Units: 32</p>
					<p>Activation: None</p>
				</div>
				<div class="right-arrow" style="background-image:url('images/rightPointer.png');">
				</div>
			</div>
			
			<div id="act-div0" class="row desc-arrow-container" onclick="updateSelected(this.id);">
				<div class="desc-container">
					<p class="layer-title">Activation</p>
					<p>Activation: softmax</p>
				</div>
				<div class="right-arrow" style="background-image:url('images/rightPointer.png');">
				</div>
			</div>
			
			<div id="drop-div0" class="row desc-arrow-container" onclick="updateSelected(this.id);">
				<div class="desc-container">
					<p class="layer-title">Dropout</p>
					<p>Rate: 0.1</p>
					<p>Seed: 42</p>
				</div>
				<div class="right-arrow" style="background-image:url('images/rightPointer.png');">
				</div>
			</div>
			
		</div>
		
		
		<!-- Parameter Selection Area - Right Side-Bar -->
		<div class="parameter-selection">
			<p>Parameters</p>
			
			<!-- Div for Dense Parameter Selection -->
			<div id="param-dense-div0" class="param-input">
				<div class="label-input">
					<label class="param-label">Units</label>
					<input class="w3-input w3-border w3-round-large param-multi-input units" type="text" value="32"></input>
				</div>
				
				<div class="label-input">
					<label class="param-label">Activation</label>
					<select class="w3-select w3-border w3-round-large param-multi-input dense-act" name="select" name="option">
						<option value="None">None</option>
						<option value="softmax">softmax</option>
						<option value="relu">relu</option>
						<option value="tanh">tanh</option>
						<option value="sigmoid">sigmoid</option>
					</select>
				</div>				
			</div> 
			
			
			<!-- Div for Activation Parameter Selection -->
			<div id="param-act-div0" class="param-input">
				<div class="label-input">
					<label class="param-label">Activation</label>
					<select class="w3-select w3-border w3-round-large param-single-input activation" name="select" name="option">
						<option value="softmax">softmax</option>
						<option value="relu">relu</option>
						<option value="tanh">tanh</option>
						<option value="sigmoid">sigmoid</option>
					</select>
				</div>	
			</div> 
			
			
			<!-- Div for Dropout Parameter Selection -->
			<div id="param-drop-div0" class="param-input">
				<div class="label-input">
					<label class="param-label">Rate</label>
					<input class="w3-input w3-border w3-round-large param-multi-input rate" type="text" value="0.1"></p>
				</div>
				
				<div class="label-input">
					<label class="param-label">Seed</label>
					<input class="w3-input w3-border w3-round-large param-multi-input seed" type="text" value="42"></p>
				</div>			
			</div> 
			<button id="save" class="layer-button w3-button w3-round-large" onclick="update()">Update</button>
			<button id="delete" class="layer-button w3-button w3-round-large" onclick="del()">Delete</button>
		</div>
	</body>

	<script>
		// track selected layer and param side bar
		var selected;
		var paramSelected;
		
		// track where new layer block should go
		var left = 50;
		
		// anchor position to start positioning layer divs
		var right = $('#drop-div0');
		var paramRight = $('#param-drop-div0');
		
		// show the parameters of a given layer div type
		function addParams(base_id) {
			<!-- Hide Divs -->
			$('.param-input').css('display', 'none');
						
			// get the last DIV which ID starts with base_id
			var $div = $('div[id^=' + base_id + ']:last');
									
			// Read the Number from that DIV's ID 
			// And increment that number by 1
			var num = parseInt( $div.prop("id").match(/\d+/g), 10 ) +1;
						
			// Clone it and assign the new ID 
			var $newdiv = $div.clone().prop('id', base_id + num );
			
			// clone html
			$newdiv.html($div.html());
			
			// put it in the right spot
			paramRight.after($newdiv);
			paramRight = $newdiv;
						
			// display the new div 
			document.getElementById($newdiv.prop('id')).style.display = 'block';
			document.getElementById('save').style.display = "block";
			document.getElementById('delete').style.display = "block";
			
			// update paramSelected
			paramSelected = $newdiv
		}
		
		// adds layer box of type base_id
		function addLayer(base_id) {
			// get the last DIV which ID starts with base_id
			var $div = $('div[id^=' + base_id + ']:last');
			
			// Read the Number from that DIV's ID
			// And increment that number by 1
			var num = parseInt( $div.prop("id").match(/\d+/g), 10 ) +1;
			
			// Clone it and assign the new ID 
			var $newdiv = $div.clone().prop('id', base_id + num );
			
			// clone html
			$newdiv.html($div.html());

			// Finally insert $newdiv wherever you are
			right.after($newdiv);
			right = $newdiv;
			
			// display new layer and update correct location
			document.getElementById($newdiv.prop('id')).style.display = "block";
			document.getElementById($newdiv.prop('id')).style.left = left + "px";
			left = left + 200;

			// update selected
			selected = $newdiv
		}	
		
		// update which layer is selected
		function updateSelected(id) {
			selected = $('#' + id)
			
			// use layer id to get param layer id
			var nums = id.match(/\d/g);
			nums = nums.join("");
			var letters = id.replace(/[0-9]/g,'');
			
			// hide old param div and replace with new one
			paramSelected.css('display', 'none');
			paramSelected = $('#param-' + letters + nums);
			paramSelected.css('display', 'block');
		}

		// updates parameters of selected box
		function update() {
			// empty out div of selected id
			selected.children(".desc-container").empty();
			
			// get base id of selected
			var letters = selected.prop('id').replace(/[0-9]/g,'');
			
			// extract values from param selection tab
			if (letters === 'dense-div') {
				var title = '<p class="layer-title">Dense</p>';
				var units = '<p>Units: ' + paramSelected.find('.units')[0].value + '</p>';
				var activation = '<p>Activation: ' + paramSelected.find('.dense-act')[0].value + '</p>';
				
				selected.children(".desc-container").append(title, units, activation);
			}
			else if (letters === 'act-div') {
				var title = '<p class="layer-title">Activation</p>';
				var activation = '<p>Activation: ' + paramSelected.find('.activation')[0].value + '</p>'
					
				selected.children(".desc-container").append(title, activation);
			}
			else if (letters === 'drop-div') {
				var title = '<p class="layer-title">Dropout</p>';
				var rate = '<p>Rate: ' + paramSelected.find('.rate')[0].value + '</p>' ;
				var speed = '<p>Seed: ' + paramSelected.find('.seed')[0].value + '</p>' ;
					
				selected.children(".desc-container").append(title, rate, speed);
			}
		}
	
		// delete given layer and push all next layers back
		function del() {
			// remove from view
			selected.css('display', 'none');
			paramSelected.css('display', 'none');
			
			// position of deleted div
			leftPos = parseInt(selected.css('left'));
			left = left - 200;
			
			// move all layers located after removed div back 200px
			$('.desc-arrow-container').each(function(i, obj) {
				// left position of each div in iteration
				curLeft = parseInt(obj.style.left);
				if (curLeft > leftPos && obj.style.display != 'none') {
					obj.style.left = (curLeft-200) + 'px';
				}
			});
			
			// track number of divs
			var howMany = 0;
			
			// set selected to last layer TODO: consider changing
			$('.desc-arrow-container').each(function(i, obj) {
				// if it is a valid layer
				if (obj.style.display != 'none') {
					// display it
					// access param display by id of obj once you update param selection
					updateSelected(obj.id);
					howMany = i;
				}
			});
			
			// if no visible layers are left, hide save and delete buttons and param selection
			if (howMany - 2 == 0) {
				<!-- Hide Divs -->
				paramSelected.css('display', 'none');
				document.getElementById('save').style.display = "none";
				document.getElementById('delete').style.display = "none";
			}
		}
			
	</script>

</html>